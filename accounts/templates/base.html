<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <title>{% block title %}ForumApp{% endblock %}</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <!-- Fontlar -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

  <!-- Tailwind Config -->
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: { 
              50: '#f0fdfa',
              100: '#ccfbf1', 
              200: '#99f6e4',
              300: '#5eead4',
              400: '#2dd4bf',
              500: '#14b8a6', 
              600: '#0d9488',
              700: '#0f766e',
              800: '#115e59',
              900: '#134e4a'
            },
            secondary: { 
              50: '#fffbeb',
              100: '#fef3c7',
              200: '#fde68a',
              300: '#fcd34d',
              400: '#fbbf24',
              500: '#f59e0b', 
              600: '#d97706',
              700: '#b45309',
              800: '#92400e',
              900: '#78350f'
            },
            accent: { 
              50: '#faf5ff',
              100: '#f3e8ff',
              200: '#e9d5ff',
              300: '#d8b4fe',
              400: '#c084fc',
              500: '#a855f7', 
              600: '#9333ea',
              700: '#7c3aed',
              800: '#6b21a8',
              900: '#581c87'
            },
          },
          fontFamily: { sans: ['Inter', 'sans-serif'] },
          animation: {
            'fade-in': 'fadeIn 0.3s ease-in-out',
            'slide-in': 'slideIn 0.3s ease-out',
            'slide-right': 'slideRight 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)',
          },
          keyframes: {
            fadeIn: {
              '0%': { opacity: '0' },
              '100%': { opacity: '1' },
            },
            slideIn: {
              '0%': { transform: 'translateX(-100%)' },
              '100%': { transform: 'translateX(0)' },
            },
            slideRight: {
              '0%': { transform: 'translateX(0px)' },
              '100%': { transform: 'translateX(15px)' },
            },
          }
        }
      }
    }
  </script>
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <style>
    .nav-link {
      position: relative;
      color: inherit;
      transition: all 0.3s ease;
    }
    .nav-link:after {
      content: '';
      position: absolute;
      width: 0;
      height: 2px;
      bottom: -2px;
      left: 0;
      background: linear-gradient(90deg, #a855f7, #14b8a6);
      transition: width 0.3s ease;
    }
    .nav-link:hover:after,
    .nav-link.active:after {
      width: 100%;
    }
    
    /* Sidebar link temel stilleri - GÜÇLÜ CSS */
    .sidebar-link {
      display: flex !important;
      align-items: center !important;
      padding: 12px 16px !important;
      margin: 2px 0 !important;
      border-radius: 12px !important;
      color: #4b5563 !important;
      text-decoration: none !important;
      position: relative !important;
      transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275) !important;
      background: transparent !important;
      transform: translateX(0px) !important;
      will-change: transform, background-color, color, box-shadow !important;
    }
    
    /* Hover durumu - EN GÜÇLÜ CSS */
    .sidebar-link:hover {
      transform: translateX(15px) !important;
      background: linear-gradient(135deg, rgba(20, 184, 166, 0.15), rgba(168, 85, 247, 0.15)) !important;
      color: #059669 !important;
      box-shadow: 0 6px 20px rgba(20, 184, 166, 0.25) !important;
      border-left: 4px solid #14b8a6 !important;
    }
    
    /* Focus durumu */
    .sidebar-link:focus {
      transform: translateX(15px) !important;
      background: linear-gradient(135deg, rgba(20, 184, 166, 0.15), rgba(168, 85, 247, 0.15)) !important;
      color: #059669 !important;
      box-shadow: 0 6px 20px rgba(20, 184, 166, 0.25) !important;
      outline: none !important;
    }
    
    /* Icon stilleri */
    .sidebar-link i {
      margin-right: 12px !important;
      width: 20px !important;
      text-align: center !important;
      transition: all 0.4s ease !important;
      font-size: 16px !important;
      display: inline-block !important;
    }
    
    /* Icon hover efekti */
    .sidebar-link:hover i {
      transform: scale(1.3) rotate(5deg) !important;
      color: #14b8a6 !important;
      filter: brightness(1.2) !important;
    }
    
    /* Text hover efekti */
    .sidebar-link:hover .sidebar-text {
      font-weight: 600 !important;
      color: #059669 !important;
    }
    
    /* Active state */
    .sidebar-link.active {
      background: linear-gradient(135deg, rgba(20, 184, 166, 0.2), rgba(168, 85, 247, 0.2)) !important;
      color: #059669 !important;
      transform: translateX(12px) !important;
      border-left: 4px solid #14b8a6 !important;
      font-weight: 600 !important;
    }
    
    /* Inline style override protection */
    .sidebar-link[style] {
      transform: translateX(0px) !important;
    }
    
    .sidebar-link[style]:hover {
      transform: translateX(15px) !important;
    }
    
    /* Popüler etiketler için hover efekti */
    .popular-tag {
      transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275) !important;
      display: inline-block !important;
      position: relative !important;
      overflow: hidden !important;
      transform: translateY(0px) scale(1) !important;
    }
    
    .popular-tag::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
      transition: left 0.5s ease;
    }
    
    .popular-tag:hover {
      transform: translateY(-3px) scale(1.05) !important;
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2) !important;
      z-index: 10 !important;
    }
    
    .popular-tag:hover::before {
      left: 100%;
    }
    
    .tag-hover:hover {
      transform: scale(1.05);
      transition: all 0.2s ease;
    }
    
    .gradient-bg {
      background: linear-gradient(135deg, #14b8a6 0%, #a855f7 100%);
    }
    
    .card-shadow {
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
      transition: all 0.3s ease;
    }
    
    .card-shadow:hover {
      box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
      transform: translateY(-2px);
    }
    
    .category-toggle {
      transition: all 0.3s ease;
      cursor: pointer;
      border-radius: 0.5rem;
      padding: 8px 12px;
    }
    
    .category-toggle:hover {
      background: rgba(20, 184, 166, 0.1);
      color: #0f766e;
      transform: translateX(5px);
    }
    
    .category-toggle i.fas.fa-chevron-down {
      transition: transform 0.3s ease;
    }
    
    .category-toggle.collapsed i.fas.fa-chevron-down {
      transform: rotate(-90deg);
    }
    
    .category-content {
      max-height: 1000px;
      overflow: hidden;
      transition: max-height 0.3s ease;
    }
    
    .category-content.collapsed {
      max-height: 0;
    }
    
    .sidebar.collapsed {
      width: 80px;
    }
    
    .sidebar.collapsed .sidebar-text {
      display: none;
    }
    
    .sidebar.collapsed .sidebar-link span {
      display: none;
    }
    
    .sidebar.collapsed .sidebar-link {
      justify-content: center;
      padding: 12px;
    }
    
    .overlay {
      background: rgba(0, 0, 0, 0.5);
      backdrop-filter: blur(4px);
    }

    .sidebar-close-btn {
      position: absolute;
      top: 16px;
      right: 16px;
      z-index: 50;
    }

    /* Debug için - çalışıp çalışmadığını görmek için */
    .sidebar-link-test {
      border: 2px solid red !important;
    }
    
    .sidebar-link-test:hover {
      border: 2px solid green !important;
      background: yellow !important;
    }

    /* CSS Grid override protection */
    .sidebar nav * {
      position: relative !important;
    }
    
    /* Force hover states */
    @media (hover: hover) {
      .sidebar-link:hover {
        transform: translateX(15px) !important;
        background: linear-gradient(135deg, rgba(20, 184, 166, 0.15), rgba(168, 85, 247, 0.15)) !important;
        color: #059669 !important;
        box-shadow: 0 6px 20px rgba(20, 184, 166, 0.25) !important;
      }
    }
  </style>
</head>

<body class="bg-gradient-to-br from-gray-50 via-primary-50 to-secondary-50 text-gray-800 font-sans flex flex-col min-h-screen">

  <!-- Mobile Sidebar Overlay -->
  <div id="sidebarOverlay" class="fixed inset-0 overlay z-30 md:hidden hidden"></div>

  <!-- Mobile Sidebar Toggle -->
  <button id="sidebarToggle" class="md:hidden fixed top-4 left-4 z-50 gradient-bg text-white p-3 rounded-lg shadow-lg hover:shadow-xl transition-all duration-300">
    <i class="fas fa-bars text-lg"></i>
  </button>
  {% include 'forum/sidebar.html' %}
  <!-- Main Content -->
  <div class="md:ml-64 flex-1 flex flex-col">

    <!-- Navbar -->
    <nav class="bg-white/90 backdrop-blur-sm border-b border-primary-200/50 shadow-sm sticky top-0 z-20">
      <div class="container mx-auto px-6 py-4 flex items-center justify-between">
        <div class="flex items-center space-x-6">
          <a href="{% url 'home' %}" class="text-2xl font-bold text-transparent bg-clip-text gradient-bg flex items-center">
            <i class="fas fa-brain mr-3 text-primary-600"></i>
            AI Forum
          </a>
          <div class="hidden md:flex space-x-6">
            <a href="{% url 'topic_list' %}" class="nav-link text-gray-700 hover:text-primary-600 flex items-center">
              <i class="fas fa-list mr-2"></i>
              Tüm Konular
            </a>
            <a href="{% url 'create_topic' %}" class="nav-link text-gray-700 hover:text-secondary-600 flex items-center">
              <i class="fas fa-plus mr-2"></i>
              Yeni Konu
            </a>
            <a href="{% url 'accounts:leaderboard' %}" class="nav-link text-gray-700 hover:text-accent-600 flex items-center">
              <i class="fas fa-trophy mr-2"></i>
              Lider Tablosu
            </a>
          </div>
        </div>

        <div class="flex items-center space-x-4">
          <form method="get" action="{% url 'search_topics' %}" class="relative">
            <input type="text" name="q" placeholder="Ara..." 
                   class="pl-10 pr-4 py-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-primary-500 focus:border-primary-500 text-sm bg-white/80 backdrop-blur-sm transition-all duration-200">
            <i class="fas fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
          </form>

          {% if request.user.is_authenticated %}
            <a href="{% url 'notifications' %}" class="relative text-gray-700 hover:text-secondary-600 transition-colors">
              <i class="far fa-bell text-xl"></i>
              {% if unread_count %}
                <span class="absolute -top-1 -right-1 bg-gradient-to-r from-secondary-500 to-secondary-600 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center animate-pulse">
                  {{ unread_count }}
                </span>
              {% endif %}
            </a>

            <a href="{% url 'accounts:user_profile' username=request.user.username %}" class="flex items-center space-x-2 hover:opacity-80 transition-opacity">
              <div class="w-8 h-8 rounded-full gradient-bg text-white flex items-center justify-center uppercase font-semibold shadow-md">
                {{ request.user.username|first }}
              </div>
            </a>
          {% else %}
            <a href="{% url 'accounts:login' %}" class="text-gray-700 hover:text-primary-600 transition-colors">Giriş Yap</a>
            <a href="{% url 'accounts:signup' %}" class="gradient-bg hover:shadow-lg text-white px-4 py-2 rounded-lg text-sm transition-all duration-300 font-medium">
              Kayıt Ol
            </a>
          {% endif %}
        </div>
      </div>
    </nav>

    <!-- Flash Messages -->
    {% if messages %}
    <div class="container mx-auto px-6 py-4 space-y-3">
      {% for message in messages %}
        <div class="flex items-center p-4 rounded-lg text-sm font-medium card-shadow animate-fade-in
                    {% if message.tags == 'success' %}bg-gradient-to-r from-green-50 to-emerald-50 text-green-800 border-l-4 border-green-500{% endif %}
                    {% if message.tags == 'error'   %}bg-gradient-to-r from-red-50 to-rose-50 text-red-800 border-l-4 border-red-500{% endif %}
                    {% if message.tags == 'info'    %}bg-gradient-to-r from-blue-50 to-cyan-50 text-blue-800 border-l-4 border-blue-500{% endif %}">
          <i class="fas 
            {% if message.tags == 'success' %}fa-check-circle text-green-500{% endif %}
            {% if message.tags == 'error'   %}fa-exclamation-circle text-red-500{% endif %}
            {% if message.tags == 'info'    %}fa-info-circle text-blue-500{% endif %} mr-3 text-lg"></i>
          {{ message }}
        </div>
      {% endfor %}
    </div>
    {% endif %}

    <!-- Page Content -->
    <main class="container mx-auto px-6 py-8 flex-1">
      {% block content %}{% endblock %}
    </main>

    <!-- Footer -->
    <footer class="bg-white/90 backdrop-blur-sm border-t border-gray-200/50 py-6">
      <div class="container mx-auto px-6 text-center text-gray-600 text-sm">
        <div class="flex items-center justify-center space-x-2 mb-2">
          <i class="fas fa-brain text-primary-600"></i>
          <span class="font-medium">© {% now "Y" %} AI Forum</span>
        </div>
        <p>Yapay zeka ve teknoloji tartışmalarının merkezi</p>
      </div>
    </footer>
  </div>

  <script>
    // DOM elementleri
    const sidebarToggle = document.getElementById('sidebarToggle');
    const sidebar = document.getElementById('sidebar');
    const overlay = document.getElementById('sidebarOverlay');
    const sidebarCollapseBtn = document.getElementById('sidebarCollapseBtn');
    const sidebarCloseBtn = document.getElementById('sidebarCloseBtn');
    
    // Console log for debugging
    console.log('🚀 Forum Base Loaded - Sidebar hover test başlatılıyor...');
    
    // Sidebar açma/kapama fonksiyonları
    function openSidebar() {
      if (sidebar && overlay) {
        sidebar.classList.remove('-translate-x-full');
        overlay.classList.remove('hidden');
        document.body.style.overflow = 'hidden';
      }
    }
    
    function closeSidebar() {
      if (sidebar && overlay) {
        sidebar.classList.add('-translate-x-full');
        overlay.classList.add('hidden');
        document.body.style.overflow = '';
      }
    }
    
    function toggleSidebar() {
      if (sidebar) {
        if (sidebar.classList.contains('-translate-x-full')) {
          openSidebar();
        } else {
          closeSidebar();
        }
      }
    }
    
    // Desktop sidebar daraltma
    function toggleSidebarCollapse() {
      if (sidebar && sidebarCollapseBtn) {
        sidebar.classList.toggle('collapsed');
        const icon = sidebarCollapseBtn.querySelector('i');
        if (icon) {
          if (sidebar.classList.contains('collapsed')) {
            icon.className = 'fas fa-chevron-right text-primary-600';
          } else {
            icon.className = 'fas fa-chevron-left text-primary-600';
          }
        }
      }
    }
    
    // Kategori açma/kapama
    function toggleCategory(button, targetId) {
      const target = document.getElementById(targetId);
      const icon = button.querySelector('i.fa-chevron-down');
      
      if (target && icon) {
        button.classList.toggle('collapsed');
        target.classList.toggle('collapsed');
        
        if (target.classList.contains('collapsed')) {
          icon.style.transform = 'rotate(-90deg)';
        } else {
          icon.style.transform = 'rotate(0deg)';
        }
      }
    }
    
    // GÜÇLÜ SIDEBAR HOVER EFEKT SİSTEMİ
    function initializeSidebarHoverEffects() {
      console.log('🎯 Sidebar hover efektleri başlatılıyor...');
      
      const sidebarLinks = document.querySelectorAll('.sidebar-link');
      console.log(`📋 ${sidebarLinks.length} sidebar link bulundu`);
      
      sidebarLinks.forEach((link, index) => {
        // Her link için hover event'leri ekle
        link.addEventListener('mouseenter', function(e) {
          console.log(`🖱️ Link ${index + 1} hover başladı:`, this.textContent.trim());
          
          // Force CSS properties with JavaScript
          this.style.setProperty('transform', 'translateX(15px)', 'important');
          this.style.setProperty('background', 'linear-gradient(135deg, rgba(20, 184, 166, 0.15), rgba(168, 85, 247, 0.15))', 'important');
          this.style.setProperty('color', '#059669', 'important');
          this.style.setProperty('box-shadow', '0 6px 20px rgba(20, 184, 166, 0.25)', 'important');
          this.style.setProperty('border-left', '4px solid #14b8a6', 'important');
          
          // Icon efekti
          const icon = this.querySelector('i');
          if (icon) {
            icon.style.setProperty('transform', 'scale(1.3) rotate(5deg)', 'important');
            icon.style.setProperty('color', '#14b8a6', 'important');
            console.log(`🎨 Icon ${index + 1} efekt uygulandı`);
          }
          
          // Text efekti
          const text = this.querySelector('.sidebar-text');
          if (text) {
            text.style.setProperty('font-weight', '600', 'important');
            text.style.setProperty('color', '#059669', 'important');
            console.log(`📝 Text ${index + 1} efekt uygulandı`);
          }
        });
        
        link.addEventListener('mouseleave', function(e) {
          console.log(`🖱️ Link ${index + 1} hover bitti`);
          
          // Reset all styles
          if (!this.classList.contains('active')) {
            this.style.removeProperty('transform');
            this.style.removeProperty('background');
            this.style.removeProperty('color');
            this.style.removeProperty('box-shadow');
            this.style.removeProperty('border-left');
            
            // Reset icon
            const icon = this.querySelector('i');
            if (icon) {
              icon.style.removeProperty('transform');
              icon.style.removeProperty('color');
            }
            
            // Reset text
            const text = this.querySelector('.sidebar-text');
            if (text) {
              text.style.removeProperty('font-weight');
              text.style.removeProperty('color');
            }
          }
        });
        
        // Click event ile test
        link.addEventListener('click', function(e) {
          console.log(`🔗 Link ${index + 1} tıklandı:`, this.href);
        });
        
        // Focus events
        link.addEventListener('focus', function(e) {
          console.log(`🎯 Link ${index + 1} focus aldı`);
          this.dispatchEvent(new Event('mouseenter'));
        });
        
        link.addEventListener('blur', function(e) {
          console.log(`🎯 Link ${index + 1} focus kaybetti`);
          this.dispatchEvent(new Event('mouseleave'));
        });
      });
      
      console.log('✅ Sidebar hover efektleri başarıyla yüklendi!');
    }
    
    // Event listener'ları ekle
    if (sidebarToggle) {
      sidebarToggle.addEventListener('click', (e) => {
        e.preventDefault();
        e.stopPropagation();
        toggleSidebar();
      });
    }
    
    if (sidebarCloseBtn) {
      sidebarCloseBtn.addEventListener('click', (e) => {
        e.preventDefault();
        e.stopPropagation();
        closeSidebar();
      });
    }
    
    if (overlay) {
      overlay.addEventListener('click', closeSidebar);
    }
    
    if (sidebarCollapseBtn) {
      sidebarCollapseBtn.addEventListener('click', (e) => {
        e.preventDefault();
        toggleSidebarCollapse();
      });
    }
    
    // Kategori toggle butonları
    document.querySelectorAll('.category-toggle').forEach(button => {
      button.addEventListener('click', function(e) {
        e.preventDefault();
        const targetId = this.getAttribute('data-target');
        if (targetId) {
          toggleCategory(this, targetId);
        }
      });
    });
    
    // Dışarı tıklama ile kapatma (sadece mobil)
    document.addEventListener('click', function(event) {
      if (window.innerWidth < 768 && sidebar && overlay) {
        const isClickInsideSidebar = sidebar.contains(event.target);
        const isClickOnToggle = sidebarToggle && sidebarToggle.contains(event.target);
        const isClickOnCloseBtn = sidebarCloseBtn && sidebarCloseBtn.contains(event.target);
        
        if (!isClickInsideSidebar && !isClickOnToggle && !isClickOnCloseBtn && !sidebar.classList.contains('-translate-x-full')) {
          closeSidebar();
        }
      }
    });
    
    // Pencere boyutu değişimini dinle
    window.addEventListener('resize', function() {
      if (window.innerWidth >= 768 && overlay) {
        overlay.classList.add('hidden');
        document.body.style.overflow = '';
      }
    });
    
    // ESC tuşu ile kapatma
    document.addEventListener('keydown', function(event) {
      if (event.key === 'Escape' && sidebar && !sidebar.classList.contains('-translate-x-full')) {
        closeSidebar();
      }
    });
    
    // DOM yüklendiğinde hover efektlerini başlat
    document.addEventListener('DOMContentLoaded', function() {
      console.log('🌟 DOM yüklendi - Hover efektleri başlatılıyor...');
      initializeSidebarHoverEffects();
      
      // Mouse hareket testi
      let mouseTestCount = 0;
      document.addEventListener('mousemove', function(e) {
        mouseTestCount++;
        if (mouseTestCount % 100 === 0) {
          console.log(`🖱️ Mouse hareket ediyor: (${e.clientX}, ${e.clientY})`);
        }
      });
    });
    
    // Sayfa yüklendiğinde de çalıştır (backup)
    window.addEventListener('load', function() {
      console.log('🚀 Sayfa tamamen yüklendi - Hover backup çalıştırılıyor...');
      setTimeout(initializeSidebarHoverEffects, 100);
    });
    
    // CSS hover test fonksiyonu
    function testCSSHover() {
      console.log('🧪 CSS hover testi başlatılıyor...');
      const testLink = document.querySelector('.sidebar-link');
      if (testLink) {
        testLink.classList.add('sidebar-link-test');
        setTimeout(() => {
          testLink.classList.remove('sidebar-link-test');
          console.log('🧪 CSS hover testi tamamlandı');
        }, 2000);
      }
    }
    
    // Test için klavye kısayolu (Ctrl + H)
    document.addEventListener('keydown', function(e) {
      if (e.ctrlKey && e.key === 'h') {
        e.preventDefault();
        console.log('🔥 Hover test başlatıldı!');
        testCSSHover();
      }
    });
    
    console.log('✨ Forum Base Script tamamen yüklendi!');
    console.log('📝 Hover test için Ctrl+H tuşlarına basın');
  </script>
</body>
</html>